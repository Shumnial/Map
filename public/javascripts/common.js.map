{"version":3,"sources":["common.js"],"names":["$","doSearch","buildPlacemark","point","layout","ymaps","templateLayoutFactory","createClass","build","superclass","call","this","on","onRemove","onMoreInfoClick","onBtnCloseClick","clear","off","alert","id","myCollection","remove","placemark","html","info","show","hide","Placemark","lon","lat","iconContent","markName","title","name","address","description","img","buttonText","balloonContentLayout","preset","add","removeAll","i","mapObjects","length","map","geoObjects","setBounds","getBounds","getCoords","myGeocoder","geocode","then","res","geoObj","get","coords","geometry","getCoordinates","err","console","log","saveInLocal","localStorage","setItem","JSON","stringify","getFromLocal","data","getItem","parse","onFormSubmit","evt","preventDefault","obj","result","serializeArray","forEach","el","value","push","target","reset","objectsForm","ready","Map","center","zoom","type","GeoObjectCollection"],"mappings":"AAAA,YAAAA,GAAE,WAsCD,QAASC,KASR,QAASC,GAAeC,GACvB,GAAMC,GAASC,MAAMC,sBAAsBC,YAA5B,oZAWbC,MAAO,WACNJ,EAAOK,WAAWD,MAAME,KAAKC,MAC7BX,EAAE,qBAAqBY,GAAG,QAASD,KAAKE,UACxCb,EAAE,cAAcY,GAAG,QAASD,KAAKG,iBACjCd,EAAE,cAAcY,GAAG,QAASD,KAAKI,kBAElCC,MAAO,WACNhB,EAAE,qBAAqBiB,IAAI,QAASN,KAAKE,UACzCb,EAAE,cAAciB,IAAI,QAASN,KAAKG,iBAClCd,EAAE,cAAciB,IAAI,QAASN,KAAKI,iBAClCX,EAAOK,WAAWO,MAAMN,KAAKC,OAE9BE,SAAU,WACTK,MAAM,uBAAyBf,EAAMgB,IAErCC,EAAaC,OAAOC,IAErBR,gBAAiB,WAChBd,EAAE,eAAeuB,KAAKpB,EAAMqB,MAC5BxB,EAAE,SAASyB,QAEZV,gBAAiB,WAChBf,EAAE,SAAS0B,UAIRJ,EAAY,GAAIjB,OAAMsB,WAAWxB,EAAMyB,IAAKzB,EAAM0B,MACvDC,YAAa3B,EAAM4B,SACnBC,MAAO7B,EAAM6B,MACbC,KAAM9B,EAAM8B,KACZC,QAAS/B,EAAM+B,QACfC,YAAahC,EAAMgC,YACnBC,IAAKjC,EAAMiC,IACXjB,GAAI,GACJkB,WAAY,kBAEZC,qBAAsBlC,EACdmC,OAAQ,2BAGjBnB,GAAaoB,IAAIlB,GA1DlBF,EAAaqB,WAEb,KAAK,GAAIC,GAAI,EAAGA,EAAIC,EAAWC,OAAQF,IACtCxC,EAAeyC,EAAWD,GA0D3BG,GAAIC,WAAWN,IAAIpB,GAEfuB,EAAWC,OAAS,KACvBC,EAAIE,UAAU3B,EAAa4B,aAI7B,QAASC,GAAWf,GACnB,GAAMgB,GAAa7C,MAAM8C,QAAQjB,EACjC,OAAOgB,GAAWE,KAAK,SAAAC,GACtB,GAAMC,GAASD,EAAIP,WAAWS,IAAI,GAC5BC,EAASF,EAASA,EAAOG,SAASC,iBAAmB,IAC3D,OAAOF,KAHDN,SAKA,SAAAS,GAAA,MAAOC,SAAQC,IAAI,QAASF,KAGpC,QAASG,KACRC,aAAaC,QAAQ,UAAWC,KAAKC,UAAUvB,IAGhD,QAASwB,KACR,GAAMC,GAAOL,aAAaM,QAAQ,UAC7BD,KAGJzB,EAAasB,KAAKK,MAAMF,IAI1B,QAASG,GAAaC,GACrBA,EAAIC,gBACJ,IAAMC,MACAC,EAAS3E,EAAEW,MAAMiE,gBACvBD,GAAOE,QAAQ,SAACC,GACfJ,EAAII,EAAG7C,MAAQ6C,EAAGC,QAGnB9B,EAAUyB,EAAIxC,SAASkB,KAAK,SAAAgB,GAC3B,MAAIA,IAIJM,EAAI9C,IAAMwC,EAAK,GACfM,EAAI7C,IAAMuC,EAAK,GACfzB,EAAWqC,KAAKN,GAChBzE,IACA6D,QACAU,GAAIS,OAAOC,aARVhE,OAAM,oBA7IT,GAAMiE,GAAcnF,EAAE,iBAClB6C,EAAAA,OACAzB,EAAAA,MACJf,OAAM+E,MAAM,WACXvC,EAAM,GAAIxC,OAAMgF,IAAI,OACnBC,QAAS,MAAO,MAChBC,KAAM,GACNC,KAAM,eAGPpE,EAAe,GAAIf,OAAMoF,oBACzBxF,KAGD,IAAI0C,KACFxB,GAAI,EACJS,IAAK,MACLC,IAAK,KACLK,QAAS,mBACTH,SAAU,UACVC,MAAO,QACPG,YAAa,YACbX,KAAM,0CACNY,IAAK,4GAELjB,GAAI,EACJS,IAAK,MACLC,IAAK,MACLK,QAAS,mBACTH,SAAU,UACVC,MAAO,mBACPG,YAAa,sBACbX,KAAM,gBAGR2C,KAsHAgB,EAAYvE,GAAG,SAAU2D","file":"../sources/common.js","sourcesContent":["$(function() {\r\n\tconst objectsForm = $('.objects-form');\r\n\tlet map;\r\n\tlet myCollection;\r\n\tymaps.ready(function() {\r\n\t\tmap = new ymaps.Map('map', {\r\n\t\t\tcenter: [56.84, 60.60],\r\n\t\t\tzoom: 12,\r\n\t\t\ttype: 'yandex#map'\r\n\t\t});\r\n\r\n\t\tmyCollection = new ymaps.GeoObjectCollection();\r\n\t\tdoSearch();\r\n\t});\r\n\r\n\tlet mapObjects = [{\r\n\t\t\tid: 1,\r\n\t\t\tlon: 56.83,\r\n\t\t\tlat: 60.60,\r\n\t\t\taddress: 'ул. Куйбышева 55',\r\n\t\t\tmarkName: 'Метка 1',\r\n\t\t\ttitle: 'Точка',\r\n\t\t\tdescription: 'Я РОДИЛСЯ',\r\n\t\t\tinfo: 'ЗАКРОЙ МЕНЯ И УХОДИ НЕ ПОРТИ ПЕЙЗАЖ ПЛЗ',\r\n\t\t\timg: 'https://www.karusel-tv.ru/media/suit/image_in_broadcast/media/image/2011/08/22/60506/24_13140160941.jpg'\r\n\t\t}, {\r\n\t\t\tid: 2,\r\n\t\t\tlon: 56.82,\r\n\t\t\tlat: 60.59,\r\n\t\t\taddress: 'ул. Куйбышева 45',\r\n\t\t\tmarkName: 'Метка 2',\r\n\t\t\ttitle: 'А я вторая точка',\r\n\t\t\tdescription: 'На меня тоже нажали',\r\n\t\t\tinfo: 'SCRRRAPAPAPA'\r\n\t\t}];\r\n\r\n\tgetFromLocal();\r\n\r\n\tfunction doSearch() {\r\n\r\n\r\n\t\tmyCollection.removeAll();\r\n\r\n\t\tfor (let i = 0; i < mapObjects.length; i++) {\r\n\t\t\tbuildPlacemark(mapObjects[i]);\r\n\t\t}\r\n\r\n\t\tfunction buildPlacemark(point) {\r\n\t\t\tconst layout = ymaps.templateLayoutFactory.createClass(\r\n\t\t\t\t`<div class=\"item\">\r\n\t\t\t\t<h3>{{properties.title}}</h3>\r\n\t\t\t\t<h3>{{properties.name}}</h3>\r\n\t\t\t\t<h3>{{properties.address}}</h3>\r\n\t\t\t\t<img src=\"{{properties.img}}\">\r\n\t\t\t\t<p>{{properties.description}}</p>\r\n\t\t\t\t<a href=\"#\" class=\"more-info\" data-id=\"{{properties.id}}\">Узнать подробнее</a>\r\n\t\t\t\t<button class=\"remove-placemark\">{{properties.buttonText}}</button>\r\n\t\t\t\t</div>`, \r\n\t\t\t\t{\r\n\t\t\t\t\tbuild: function() {\r\n\t\t\t\t\t\tlayout.superclass.build.call(this);\r\n\t\t\t\t\t\t$('.remove-placemark').on('click', this.onRemove);\r\n\t\t\t\t\t\t$('.more-info').on('click', this.onMoreInfoClick);\r\n\t\t\t\t\t\t$('.close-btn').on('click', this.onBtnCloseClick);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tclear: function() {\r\n\t\t\t\t\t\t$('.remove-placemark').off('click', this.onRemove);\r\n\t\t\t\t\t\t$('.more-info').off('click', this.onMoreInfoClick);\r\n\t\t\t\t\t\t$('.close-btn').off('click', this.onBtnCloseClick);\r\n\t\t\t\t\t\tlayout.superclass.clear.call(this);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tonRemove: function() {\r\n\t\t\t\t\t\talert('Удаление метки с id ' + point.id);\r\n\t\t\t\t\t\t// post на сервер\r\n\t\t\t\t\t\tmyCollection.remove(placemark);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tonMoreInfoClick: function() {\r\n\t\t\t\t\t\t$('.info__text').html(point.info);\r\n\t\t\t\t\t\t$('.info').show();\r\n\t\t\t\t\t},\r\n\t\t\t\t\tonBtnCloseClick: function() {\r\n\t\t\t\t\t\t$('.info').hide();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\tconst placemark = new ymaps.Placemark([point.lon, point.lat], {\r\n\t\t\t\ticonContent: point.markName,\r\n\t\t\t\ttitle: point.title,\r\n\t\t\t\tname: point.name,\r\n\t\t\t\taddress: point.address,\r\n\t\t\t\tdescription: point.description,\r\n\t\t\t\timg: point.img,\r\n\t\t\t\tid: '',\r\n\t\t\t\tbuttonText: \"Удалить метку\"\r\n\t\t\t}, {\r\n\t\t\t\tballoonContentLayout: layout,\r\n            preset: 'twirl#nightStretchyIcon' // иконка растягивается под контент\r\n          });\r\n\r\n\t\t\tmyCollection.add(placemark);\r\n\t\t}\r\n\r\n\t\tmap.geoObjects.add(myCollection);\r\n\r\n\t\tif (mapObjects.length > '2') {\r\n\t\t\tmap.setBounds(myCollection.getBounds());\r\n\t\t}\r\n\t};\r\n\r\n\tfunction getCoords (address) {\r\n\t\tconst myGeocoder = ymaps.geocode(address);\r\n\t\treturn myGeocoder.then(res => {\r\n\t\t\tconst geoObj = res.geoObjects.get(0);\r\n\t\t\tconst coords = geoObj ? geoObj.geometry.getCoordinates() : null;\r\n\t\t\treturn coords;\r\n\t\t})\r\n\t\t.catch(err => console.log(\"err: \", err))\r\n\t};\r\n\r\n\tfunction saveInLocal() {\r\n\t\tlocalStorage.setItem('objects', JSON.stringify(mapObjects));\r\n\t};\r\n\r\n\tfunction getFromLocal() {\r\n\t\tconst data = localStorage.getItem('objects');\r\n\t\tif (!data) {\r\n\t\t\treturn;\r\n\t\t} else {\r\n\t\t\tmapObjects = JSON.parse(data);\r\n\t\t}\r\n\t};\r\n\r\n\tfunction onFormSubmit(evt) {\r\n\t\tevt.preventDefault();\r\n\t\tconst obj = {};\r\n\t\tconst result = $(this).serializeArray();\r\n\t\tresult.forEach((el) => {\r\n\t\t\tobj[el.name] = el.value;\r\n\t\t});\r\n\r\n\t\tgetCoords(obj.address).then(data => {\r\n\t\t\tif(!data) {\r\n\t\t\t\talert('Неверный адрес');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tobj.lon = data[0];\r\n\t\t\tobj.lat = data[1];\r\n\t\t\tmapObjects.push(obj);\r\n\t\t\tdoSearch();\r\n\t\t\tsaveInLocal();\r\n\t\t\tevt.target.reset();\r\n\t\t});\r\n\t};\r\n\r\n\tobjectsForm.on('submit', onFormSubmit);\r\n});"]}