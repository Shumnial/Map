"use strict";$(function(){function t(){function t(t){var e=ymaps.templateLayoutFactory.createClass('<div class="item" data-id="{{properties.id}}" data-descr="{{properties.descr}}">\n\t\t\t\t<h3 class="item__name">{{properties.name}}</h3>\n\t\t\t\t<h3 class="item__address">{{properties.address}}</h3>\n\t\t\t\t<img src="{{properties.img}}">\n\t\t\t\t<a href="#" class="more-info">Узнать подробнее</a>\n\t\t\t\t<button class="edit-placemark">Изменить</button>\n\t\t\t\t<button class="remove-placemark">Удалить</button>\n\t\t\t\t</div>',{build:function(){e.superclass.build.call(this),$(".remove-placemark").on("click",this.onRemove),$(".more-info").on("click",this.onMoreInfoClick),$(".close-btn").on("click",this.onBtnCloseClick),$(".edit-placemark").on("click",this.onBtnEditClick)},clear:function(){$(".remove-placemark").off("click",this.onRemove),$(".more-info").off("click",this.onMoreInfoClick),$(".close-btn").off("click",this.onBtnCloseClick),$(".edit-placemark").off("click",this.onBtnEditClick),e.superclass.clear.call(this)},onRemove:function(){alert("Удаление метки с id "+t.id);var e=localStorage.getItem("objects"),n=JSON.parse(e),i=$(this).closest(".item").attr("data-id");n.forEach(function(t,e){i==t.id&&(r.splice(e,1),localStorage.setItem("objects",JSON.stringify(r)))}),c.remove(o)},onMoreInfoClick:function(){$(".info__text").html(t.info),$(".info").show()},onBtnCloseClick:function(){$(".info").hide()},onBtnEditClick:function(){var t=this,e=$(".objects-form__name"),o=$(".objects-form__address"),n=$(".objects-form__info"),i=$(this).siblings(".item__name").text(),a=$(this).siblings(".item__address").text(),s=$(this).closest(".item").attr("data-descr");e.val(i),o.val(a),n.val(s),$(".overlay").show(),$(".objects-form").on("submit",function(){$(".overlay").hide(),$(t).siblings(".remove-placemark").click()})}}),o=new ymaps.Placemark([t.lon,t.lat],{iconContent:t.markName,name:t.name,address:t.address,descr:t.info,img:t.img,id:t.id},{balloonContentLayout:e,preset:"twirl#nightStretchyIcon"});c.add(o)}c.removeAll();for(var e=0;e<r.length;e++)t(r[e]);s.geoObjects.add(c),r.length>"2"&&s.setBounds(c.getBounds())}function e(t){var e=ymaps.geocode(t);return e.then(function(t){var e=t.geoObjects.get(0),o=e?e.geometry.getCoordinates():null;return o})["catch"](function(t){return console.log("err: ",t)})}function o(){localStorage.setItem("objects",JSON.stringify(r))}function n(){var t=localStorage.getItem("objects");t&&(r=JSON.parse(t))}function i(n){n.preventDefault();var i={},a=$(this).serializeArray();a.forEach(function(t){i[t.name]=t.value}),e("'г. Екатеринбург, "+i.address).then(function(e){return e?(i.lon=e[0],i.lat=e[1],i.id=Date.now(),r.push(i),t(),o(),void n.target.reset()):void alert("Неверный адрес")})}var a=$(".objects-form"),s=void 0,c=void 0;ymaps.ready(function(){s=new ymaps.Map("map",{center:[56.84,60.6],zoom:12,type:"yandex#map"}),c=new ymaps.GeoObjectCollection,t()});var r=[];n(),a.on("submit",i)});
//# sourceMappingURL=../javascripts/common.js.map
